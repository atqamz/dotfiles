#!/usr/bin/env bash
set -euo pipefail

script_dir="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" && pwd)"
# shellcheck disable=SC1090
source "${ROFI_COMMON:-$script_dir/rofi-common}"

main() {
  require_cmd rofimoji
  require_cmd wl-paste
  require_cmd wtype
  rofi_init "${EMOJI_PICKER_ROFI_BIN:-}"

  prompt="${1:-${EMOJI_PICKER_PROMPT:-Emoji}}"
  # shellcheck disable=SC2206
  extra_args=( ${EMOJI_PICKER_ROFI_ARGS:-} )

  rofi_cmd=(
    -dmenu
    -i
    -p "$prompt"
    -normal-window
    -matching normal
    -show-icons
    -width 40
    -lines 12
    -line-margin 4
    -line-padding 6
  )
  rofi_cmd+=( "${extra_args[@]}" )

  rofi_args_str=$(rofi_args_string "${rofi_cmd[@]}")

  selection=$(rofimoji --selector rofi --selector-args "$rofi_args_str" --action copy print)
  selection=${selection%$'\n'}
  [[ -n "$selection" ]] || exit 0

  wl-paste --no-newline | wtype -
  if has_cmd notify-send; then
    notify-send "Emoji picker" "Inserted emoji from rofimoji"
  fi
}

main "$@"
